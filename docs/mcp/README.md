# Chat with Data via LLM + MCP + API Integration

We are implementing a conversational interface that allows users to interact with their financial data naturally. This is achieved by combining:
- A local LLM (Large Language Model)
- A Model Context Provider (MCP) that integrates with our existing backend APIs

## How It Works

- **User Query:**
  - The user enters a natural language query in the chat interface (e.g., "Show my grocery spend last month").

- **LLM Processing:**
  - The query is forwarded to the local LLM, which interprets the request and determines the user’s intent.
  - The LLM has access to a list of tools (functions) exposed by MCP that correspond to backend capabilities.

- **Tool Selection:**
  - Based on its understanding of the query, the LLM selects the appropriate tool (e.g., `get_transactions`) and identifies the required parameters (e.g., category and date range).

- **MCP Execution:**
  - The MCP maps the selected tool to a predefined API endpoint. It:
    - Substitutes placeholders in the endpoint URL (e.g., `{user_id}`)
    - Formats any query parameters or request body
    - Attaches authentication tokens or session details
    - Sends an HTTP request to the backend API

- **API Response:**
  - The backend API receives the request, executes the associated business logic, and returns a structured JSON response (e.g., a list of transactions or budget data).

- **LLM Response Generation:**
  - The MCP forwards this structured data back to the LLM, which combines it with the original query context.
  - The LLM then generates a user-friendly, natural language answer.

- **Frontend Display:**
  - The generated response is returned to the chat interface and displayed to the user.
  - This completes the interaction loop while maintaining conversational context.

## Key Components

- **Local LLM:** Interprets user queries, determines intent, and generates natural language responses.
- **Model Context Provider (MCP):** Registers available tools, maps them to API endpoints, and executes secure, authenticated HTTP requests.
- **Existing Backend APIs:** Provide all required data operations (transactions, budgets, goals) using the current production logic.
- **Frontend Chat Interface:** Handles user input/output and displays responses generated by the LLM.

## System Architecture Flow

```
                        ┌────────────────────────────┐
                        │        Frontend UI         │
                        │ (Transactions, Budgets UI) │
                        └─────────────┬──────────────┘
                                      │
      Normal API Flow                  │ Chat Flow
                                      │
              ┌───────────────────────┴───────────────────────────┐
              │                                                   │
              ▼                                                   ▼
   ┌─────────────────────┐                             ┌─────────────────────┐
   │   API Gateway /     │                             │  Frontend Chat UI   │
   │ Backend API Layer   │                             │ (User enters query) │
   └───────────┬─────────┘                             └─────────┬───────────┘
               │                                                 │
               ▼                                                 ▼
      ┌───────────────────┐                          ┌─────────────────────┐
      │ Business Logic /  │                          │      Local LLM      │
      │ Existing Services │                          │  (Understands query │
      └─────────┬─────────┘                          │   & selects tools)  │
                │                                    └─────────┬───────────┘
                │                                              │
                ▼                                              ▼
      ┌───────────────────┐                       ┌─────────────────────────┐
      │ Database Layer    │                       │ MCP (Tool Registry &    │
      │ (Transactions,    │                       │ API Integration Layer)  │
      │ Budgets, Goals)   │                       └───────────┬────────────┘
      └───────────────────┘                                   │
                                                               ▼
                                                    ┌─────────────────────────┐
                                                    │ Backend API (Existing)  │
                                                    │ (Transactions, Budgets, │
                                                    │ Goals Logic)            │
                                                    └───────────┬────────────┘
                                                                │
                                                                ▼
                                                    ┌─────────────────────────┐
                                                    │ Database Layer          │
                                                    │ (Financial Data)        │
                                                    └─────────────────────────┘
```

- The diagram above illustrates both the normal API flow and the chat flow.
- The left side shows the traditional API request/response cycle.
- The right side shows the conversational chat flow, highlighting the role of the Local LLM and MCP.
- Both flows ultimately interact with the same backend APIs and database layers for data retrieval and business logic.

